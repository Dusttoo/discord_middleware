/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){if(game&&game.settings)if(game.settings.get(oe,"debugMode")){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(e=console).log.apply(e,["[".concat(oe," Debug] ").concat(t)].concat(r))}else console.log("[Discord Bot Integration] Debug mode is disabled.");else console.warn("[".concat(oe," Debug] Game settings not available"))}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(){r=function(){return e};var t,e={},a=Object.prototype,o=a.hasOwnProperty,c=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),i=new C(r||[]);return c(o,"_invoke",{value:q(t,n,i)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var m="suspendedStart",h="suspendedYield",y="executing",g="completed",v={};function b(){}function w(){}function x(){}var k={};f(k,s,(function(){return this}));var I=Object.getPrototypeOf,S=I&&I(I(T([])));S&&S!==a&&o.call(S,s)&&(k=S);var E=x.prototype=b.prototype=Object.create(k);function L(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function N(t,e){function r(a,c,i,s){var u=p(t[a],t,c);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&o.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,s)}))}s(u.arg)}var a;c(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}})}function q(e,n,r){var a=m;return function(o,c){if(a===y)throw Error("Generator is already running");if(a===g){if("throw"===o)throw c;return{value:t,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var s=D(i,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===m)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=y;var u=p(e,n,r);if("normal"===u.type){if(a=r.done?g:h,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=g,r.method="throw",r.arg=u.arg)}}}function D(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,D(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=p(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var c=o.arg;return c?c.done?(n[e.resultName]=c.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,c=function n(){for(;++a<e.length;)if(o.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return c.next=c}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,c(E,"constructor",{value:x,configurable:!0}),c(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(N.prototype),f(N.prototype,u,(function(){return this})),e.AsyncIterator=N,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var c=new N(d(t,n,r,a),o);return e.isGeneratorFunction(n)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},L(E),f(E,l,"Generator"),f(E,s,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return i.type="throw",i.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],i=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var s=o.call(c,"catchLoc"),u=o.call(c,"finallyLoc");if(s&&u){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=t,c.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;O(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e,n,r,a,o,c){try{var i=t[o](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var c=t.apply(e,n);function i(t){o(c,r,a,i,s,"next",t)}function s(t){o(c,r,a,i,s,"throw",t)}i(void 0)}))}}function i(t){return s.apply(this,arguments)}function s(){return(s=c(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={name:e.name,hp:e.system.attributes.hp.value,maxHp:e.system.attributes.hp.max,ac:e.system.attributes.ac.value,abilities:Object.entries(e.system.abilities).map((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,c,i=[],s=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(i.push(r.value),i.length!==e);s=!0);}catch(t){u=!0,a=t}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw a}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];return{name:o.toUpperCase(),value:c.value,mod:c.mod,dc:c.dc}}))},t.next=4,renderTemplate("modules/discord-bot-integration/templates/character-stats.html",n);case 4:o=t.sent,ChatMessage.create({content:o,whisper:ChatMessage.getWhisperRecipients("GM")});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function u(t){return l.apply(this,arguments)}function l(){return(l=c(r().mark((function t(e){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={inventory:e.items.map((function(t){return{name:t.name,quantity:t.system.quantity||1,equipped:t.system.equipped||!1}}))},t.next=4,renderTemplate("modules/discord-bot-integration/templates/inventory.html",n);case 4:a=t.sent,ChatMessage.create({content:a,whisper:ChatMessage.getWhisperRecipients("GM")});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t,e){return d.apply(this,arguments)}function d(){return(d=c(r().mark((function t(e,n){var a,o,c;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=e.items.get(n))&&"spell"===a.type){t.next=3;break}return t.abrupt("return");case 3:return o={name:a.name,level:a.system.level,description:a.system.description.value,uses:a.system.uses},t.next=7,renderTemplate("modules/discord-bot-integration/templates/spell-details.html",o);case 7:c=t.sent,ChatMessage.create({content:c,whisper:ChatMessage.getWhisperRecipients("GM")});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return m.apply(this,arguments)}function m(){return(m=c(r().mark((function t(e){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={combatantName:e.name,currentHp:e.system.attributes.hp.value,maxHp:e.system.attributes.hp.max,ac:e.system.attributes.ac.value},t.next=4,renderTemplate("modules/discord-bot-integration/templates/turn-notification.html",n);case 4:a=t.sent,ChatMessage.create({content:a});case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){e("".concat(oe," | findActorByNameOrId:"),t);var n=game.actors.get(t);if(e("".concat(oe," | findActorByNameOrId:"),n),!n){var r=game.actors.filter((function(e){return e.name.toLowerCase()===t.toLowerCase()}));if(e("".concat(oe," | findActorByNameOrId:"),r),1===r.length)n=r[0];else if(r.length>1)throw new Error("Multiple characters found with the name '".concat(t,"'. Please use an ID."))}return n}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e,n){return(e=function(t){var e=function(t){if("object"!=y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(){w=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,c=Object.create(o.prototype),i=new C(r||[]);return a(c,"_invoke",{value:q(t,n,i)}),c}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",p="suspendedYield",m="executing",h="completed",g={};function v(){}function b(){}function x(){}var k={};u(k,c,(function(){return this}));var I=Object.getPrototypeOf,S=I&&I(I(T([])));S&&S!==n&&r.call(S,c)&&(k=S);var E=x.prototype=v.prototype=Object.create(k);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function N(t,e){function n(a,o,c,i){var s=f(t[a],t,o);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==y(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,c,i)}),(function(t){n("throw",t,c,i)})):e.resolve(l).then((function(t){u.value=t,c(u)}),(function(t){return n("throw",t,c,i)}))}i(s.arg)}var o;a(this,"_invoke",{value:function(t,r){function a(){return new e((function(e,a){n(t,r,e,a)}))}return o=o?o.then(a,a):a()}})}function q(e,n,r){var a=d;return function(o,c){if(a===m)throw Error("Generator is already running");if(a===h){if("throw"===o)throw c;return{value:t,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var s=D(i,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===d)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=m;var u=f(e,n,r);if("normal"===u.type){if(a=r.done?h:p,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=h,r.method="throw",r.arg=u.arg)}}}function D(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,D(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=f(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var c=o.arg;return c?c.done?(n[e.resultName]=c.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(y(e)+" is not iterable")}return b.prototype=x,a(E,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=u(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,u(t,s,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},L(N.prototype),u(N.prototype,i,(function(){return this})),e.AsyncIterator=N,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var c=new N(l(t,n,r,a),o);return e.isGeneratorFunction(n)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},L(E),u(E,s,"Generator"),u(E,c,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return i.type="throw",i.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],i=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var s=r.call(c,"catchLoc"),u=r.call(c,"finallyLoc");if(s&&u){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=t,c.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;O(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function x(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,c,i=[],s=!0,u=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(i.push(r.value),i.length!==e);s=!0);}catch(t){u=!0,a=t}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw a}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return k(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function I(t,e,n,r,a,o,c){try{var i=t[o](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function S(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function c(t){I(o,r,a,c,i,"next",t)}function i(t){I(o,r,a,c,i,"throw",t)}c(void 0)}))}}function E(t){return L.apply(this,arguments)}function L(){return(L=S(w().mark((function t(n){var r,a,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | getCharacterStats:"),n.actorId),game.ready){t.next=4;break}return console.warn("".concat(oe," | Game is not ready. Cannot access actors yet.")),t.abrupt("return",{error:"Game is not ready. Please try again shortly."});case 4:if(r=h(n.actorId)){t.next=9;break}return e("".concat(oe," | Actor with ID ").concat(n.actorId," not found")),console.warn("Actor with ID ".concat(n.actorId," not found in game.actors")),t.abrupt("return",{error:"Actor with ID ".concat(n.actorId," not found")});case 9:return a=Object.keys(r.system.abilities).reduce((function(t,e){return t[e]={value:r.system.abilities[e].value,mod:r.system.abilities[e].mod,dc:r.system.abilities[e].dc},t}),{}),o={name:r.name,hp:{value:r.system.attributes.hp.value,max:r.system.attributes.hp.max,temp:r.system.attributes.hp.temp||0},ac:r.system.attributes.ac.value,abilities:a},t.next=13,i(r);case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(t){return q.apply(this,arguments)}function q(){return(q=S(w().mark((function t(n){var r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | getCharacterInventory:"),n.actorId),r=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(n.actorId," not found")),console.warn("Actor with ID ".concat(n.actorId," not found")),t.abrupt("return",[]);case 6:return t.next=8,u(r);case 8:return e("".concat(oe," | getCharacterInventory:"),r.items),t.abrupt("return",r.items.filter((function(t){return["loot","equipment","weapon","consumable","tool"].includes(t.type)})).map((function(t){return{name:t.name,quantity:t.system.quantity,equipped:t.system.equipped}})));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t){return j.apply(this,arguments)}function j(){return(j=S(w().mark((function t(n){var r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | getCharacterSpells:"),n.actorId),r=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(n.actorId," not found")),console.warn("Actor with ID ".concat(n.actorId," not found")),t.abrupt("return",[]);case 6:return t.next=8,f(r);case 8:return e("".concat(oe," | getCharacterSpells:"),r.items),t.abrupt("return",r.items.filter((function(t){return"spell"===t.type})).map((function(t){return{name:t.name,level:t.system.level,description:t.system.description.value,uses:t.system.uses}})));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t,e){return C.apply(this,arguments)}function C(){return(C=S(w().mark((function t(n,r){var a,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=h(n.actorId)){t.next=5;break}return e("".concat(oe," | Actor with ID ").concat(n.actorId," not found")),console.warn("Actor with ID ".concat(n.actorId," not found")),t.abrupt("return");case 5:return o=a.items.filter((function(t){return"spell"===t.type})).map((function(t){return{name:t.name,level:t.system.level,description:t.system.description.value,uses:t.system.uses}})),e("".concat(oe," | sendCharacterSpells:"),n.actorId,o),game.socket.emit("module.discord-bot-integration",{action:"characterSpells",requestId:r,spells:o}),t.abrupt("return",o);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(t){return P.apply(this,arguments)}function P(){return(P=S(w().mark((function t(n){var r,a,o,c,i,s,u;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.hpChange,o=n.requestId,e("".concat(oe," | updateCharacterHP:"),r,Number(a)),t.prev=2,i=h(n.actorId)){t.next=8;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 8:return s=i.system.attributes.hp.value,u=Math.max(0,s+Number(a)),t.next=12,i.updateSource({"system.attributes.hp.value":u});case 12:return null!==(c=i.sheet)&&void 0!==c&&c.rendered&&i.sheet.render(!0),t.next=15,game.socket.emit("module.discord-bot-integration",{action:"characterHPUpdated",requestId:o,newHP:u});case 15:return t.abrupt("return",u);case 18:t.prev=18,t.t0=t.catch(2),console.error("".concat(oe," | Error updating HP for actor ID ").concat(r,":"),t.t0);case 21:case"end":return t.stop()}}),t,null,[[2,18]])})))).apply(this,arguments)}function A(t){return M.apply(this,arguments)}function M(){return(M=S(w().mark((function t(n){var r,a,o,c,i,s,u,l;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.condition,o=n.add,c=n.requestId,i=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 6:if(t.prev=6,s=i.effects.map((function(t){return t.label})),u=s.includes(a),!o||u){t.next=14;break}return t.next=12,i.createEmbeddedDocuments("ActiveEffect",[{label:a,icon:R(a),origin:i.uuid,"flags.core.statusId":a,disabled:!1}]);case 12:t.next=18;break;case 14:if(o||!u){t.next=18;break}return l=i.effects.find((function(t){return t.label===a})),t.next=18,l.delete();case 18:return s=i.effects.map((function(t){return t.label})),e("".concat(oe," | updateCharacterCondition:"),r,a,o),game.socket.emit("module.discord-bot-integration",{action:"characterConditionUpdated",requestId:c,condition:a,status:o?"added":"removed"}),t.abrupt("return","".concat(a," ").concat(o?"added":"removed"));case 24:throw t.prev=24,t.t0=t.catch(6),console.error("".concat(oe," | Error updating condition for actor ID ").concat(r,":"),t.t0),t.t0;case 28:case"end":return t.stop()}}),t,null,[[6,24]])})))).apply(this,arguments)}function R(t){return{Poisoned:"icons/svg/status/poison.svg",Stunned:"icons/svg/status/stun.svg",Blinded:"icons/svg/status/blind.svg"}[t]||"icons/svg/status/default.svg"}function _(t){return G.apply(this,arguments)}function G(){return(G=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.resourceName,o=n.value,c=n.requestId,i=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 6:if(!i.system.resources[a]){t.next=12;break}return t.next=10,i.update(b({},"system.resources.".concat(a,".value"),o));case 10:t.next=14;break;case 12:return console.warn("Resource ".concat(a," not found for actor ").concat(r)),t.abrupt("return","Resource ".concat(a," not found for actor ").concat(r));case 14:return e("".concat(oe," | updateResource:"),r,a,o),game.socket.emit("module.discord-bot-integration",{action:"characterResourceUpdated",requestId:c,resourceName:a,newValue:o}),t.abrupt("return","".concat(a," updated to ").concat(o));case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(t){return U.apply(this,arguments)}function U(){return(U=S(w().mark((function t(n){var r,a,o,c,i,s,u,l;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.itemData,o=n.requestId,c=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 6:if(!(i=c.items.find((function(t){return t.name===a.name})))){t.next=16;break}return s=(i.system.quantity||1)+(a.system.quantity||1),t.next=11,i.update({"system.quantity":s});case 11:return e("".concat(oe," | Updated quantity of existing item:"),i.id,s),game.socket.emit("module.discord-bot-integration",{action:"itemQuantityUpdated",requestId:o,itemId:i.id,itemName:i.name,newQuantity:s}),t.abrupt("return",i);case 16:return t.prev=16,t.next=19,c.createEmbeddedDocuments("Item",[a]);case 19:if(!((u=t.sent).length>0)){t.next=27;break}return l=u[0],e("".concat(oe," | addItemToInventory:"),c.id,a,l),game.socket.emit("module.discord-bot-integration",{action:"itemAddedToInventory",requestId:o,itemId:l.id,itemName:l.name}),t.abrupt("return",l);case 27:return console.warn("".concat(oe," | Failed to add item to inventory for actor ").concat(r)),t.abrupt("return",null);case 29:t.next=36;break;case 31:return t.prev=31,t.t0=t.catch(16),console.error("Error adding item to inventory:",t.t0),e("".concat(oe," | Error adding item to inventory:"),t.t0),t.abrupt("return",null);case 36:case"end":return t.stop()}}),t,null,[[16,31]])})))).apply(this,arguments)}function F(t){return Q.apply(this,arguments)}function Q(){return(Q=S(w().mark((function t(n){var r,a,o,c,i,s,u,l,f;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.itemId,o=n.requestId,c=n.quantity,i=void 0===c?1:c,s=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 6:if(u=s.items.get(a)){t.next=10;break}return console.warn("Item with ID ".concat(a," not found in inventory")),t.abrupt("return");case 10:if(!((l=u.system.quantity||1)>i)){t.next=20;break}return f=l-i,t.next=15,u.update({"system.quantity":f});case 15:return e("".concat(oe," | Updated quantity of item:"),a,f),game.socket.emit("module.discord-bot-integration",{action:"itemQuantityUpdated",requestId:o,itemId:a,itemName:u.name,newQuantity:f}),t.abrupt("return",u);case 20:return t.next=22,u.delete();case 22:return e("".concat(oe," | removeItemFromInventory:"),r,a),game.socket.emit("module.discord-bot-integration",{action:"itemRemovedFromInventory",requestId:o,itemId:a,itemName:u.name}),t.abrupt("return","Item ".concat(u.name," removed from inventory"));case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(t){return B.apply(this,arguments)}function B(){return(B=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.actorId,a=n.itemId,o=n.requestId,c=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(r," not found")),console.warn("Actor with ID ".concat(r," not found")),t.abrupt("return");case 6:if(i=c.items.get(a)){t.next=10;break}return console.warn("Item with ID ".concat(a," not found in inventory")),t.abrupt("return");case 10:return e("".concat(oe," | getItemDetails:"),r,a),game.socket.emit("module.discord-bot-integration",{action:"itemDetails",requestId:o,itemDetails:{name:i.name,description:i.system.description.value,quantity:i.system.quantity,weight:i.system.weight,effects:i.system.effects}}),t.abrupt("return",i);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){return J.apply(this,arguments)}function J(){return(J=S(w().mark((function t(n){var r,a,o,c,i,s,u,l,f;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.requestId,c=n.actorId,i=h(n.actorId)){t.next=6;break}return e("".concat(oe," | Actor with ID ").concat(c," not found")),console.warn("Actor with ID ".concat(c," not found")),t.abrupt("return");case 6:if(game.combat){t.next=9;break}return e("".concat(oe," | No active combat encounter found")),t.abrupt("return","No active combat encounter found.");case 9:if(s=game.combat.combatants.find((function(t){return t.actorId===c}))){t.next=22;break}return t.prev=11,t.next=14,game.combat.createEmbeddedDocuments("Combatant",[{actorId:c}]);case 14:s=game.combat.combatants.find((function(t){return t.actorId===c})),e("".concat(oe," | Combatant added:"),s),t.next=22;break;case 18:return t.prev=18,t.t0=t.catch(11),console.error("".concat(oe," | Error adding combatant:"),t.t0),t.abrupt("return","Failed to add ".concat(i.name," to combat."));case 22:return t.next=24,i.rollInitiative();case 24:u=void 0,l=0;case 26:if(!(void 0===u&&l<5)){t.next=33;break}return t.next=29,new Promise((function(t){return setTimeout(t,100)}));case 29:u=null===(f=game.combat.combatants.find((function(t){return t.actorId===c})))||void 0===f?void 0:f.initiative,l++,t.next=26;break;case 33:return e("".concat(oe," | rollInitiative:"),c,u,null===(r=s)||void 0===r?void 0:r.id),game.socket.emit("module.discord-bot-integration",{action:"initiativeRolled",requestId:o,actorName:i.name,initiative:u}),t.abrupt("return","Initiative rolled for ".concat(i.name," with result: ").concat(null!==(a=u)&&void 0!==a?a:"unavailable"));case 36:case"end":return t.stop()}}),t,null,[[11,18]])})))).apply(this,arguments)}function X(t){return $.apply(this,arguments)}function $(){return($=S(w().mark((function t(n){var r,a,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.requestId,a=game.combats.active,e("".concat(oe," | sendTurnNotification - combat:"),game.combats),a){t.next=7;break}return e("".concat(oe," | No active combat found")),console.warn("No active combat found"),t.abrupt("return");case 7:return p((o=a.combatant).actor),e("".concat(oe," | sendTurnNotification:"),o.actor.name),o&&game.socket.emit("module.discord-bot-integration",{action:"turnNotification",requestId:r,combatantName:o.actor.name,combatantId:o.actor.id}),t.abrupt("return","Turn notification sent for ".concat(o.actor.name));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(t){return V.apply(this,arguments)}function V(){return(V=S(w().mark((function t(n){var r,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=game.combats.active){t.next=5;break}return e("".concat(oe," | No active combat found")),console.warn("No active combat found"),t.abrupt("return","No active combat found");case 5:return a=r.combatants.map((function(t){return{name:t.actor.name,initiative:t.initiative,id:t.actor.id}})),e("".concat(oe," | sendCombatSummary:"),a),game.socket.emit("module.discord-bot-integration",{action:"combatSummary",requestId:n,combatants:a}),t.abrupt("return",a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Z(t){return K.apply(this,arguments)}function K(){return(K=S(w().mark((function t(e){var n,r,a,o,c,i,s,u,l,f,d,p,m,y,g,v,b,x,k,I,S,E,L;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.requestId,r=e.actorId,a=e.targetId,o=h(e.actorId),c=h(a),o){t.next=6;break}return console.warn("Attacker with ID ".concat(r," not found")),t.abrupt("return","Attacker with ID ".concat(r," not found"));case 6:if(c){t.next=9;break}return console.warn("Target with ID ".concat(a," not found")),t.abrupt("return","Target with ID ".concat(a," not found"));case 9:return t.prev=9,i=o.getRollData(),t.next=14,new Roll("1d20 + @abilities.str.mod",i).evaluate();case 14:return s=t.sent,u=c.system.attributes.ac.value,l=20===s.total,f=1===s.total,d="".concat(o.name," rolls an attack of ").concat(s.total," against ").concat(c.name," (AC: ").concat(u,")."),p="1d8 + @abilities.str.mod",m=l?"2 * (".concat(p,")"):p,t.next=23,new Roll(m,i).evaluate();case 23:if(y=t.sent,g=Math.max(y.total,1),!l){t.next=37;break}if(d+=" Critical hit! ".concat(o.name," deals ").concat(g," damage to ").concat(c.name,"."),!y){t.next=30;break}return t.next=30,y.toMessage({speaker:ChatMessage.getSpeaker({actor:o}),flavor:"".concat(o.name,"'s critical hit damage!")});case 30:return v=c.system.attributes.hp.value,b=Math.max(0,v-g),t.next=34,c.update({"system.attributes.hp.value":b});case 34:game.socket.emit("module.discord-bot-integration",{action:"attackResult",requestId:n,actorName:o.name,targetName:c.name,attackTotal:s.total,damageTotal:g,isHit:!0,isCritHit:!0}),t.next=64;break;case 37:if(!f){t.next=49;break}if(void 0,x=(w=[{message:"You slip and fall prone.",attackerDamage:0},{message:"You drop your weapon!",attackerDamage:0},{message:"You injure yourself slightly, taking 1 point of damage.",attackerDamage:1},{message:"You swing wildly, hitting an ally nearby.",attackerDamage:0},{message:"You are disoriented, and your next attack roll is at disadvantage.",attackerDamage:0}])[Math.floor(Math.random()*w.length)],d+=" Critical miss! ".concat(o.name," fumbles: ").concat(x.message),!x.attackerDamage){t.next=46;break}return k=o.system.attributes.hp.value,I=Math.max(0,k-x.attackerDamage),t.next=45,o.update({"system.attributes.hp.value":I});case 45:d+=" ".concat(o.name," takes ").concat(x.attackerDamage," damage due to the fumble.");case 46:game.socket.emit("module.discord-bot-integration",{action:"attackResult",requestId:n,actorName:o.name,targetName:c.name,attackTotal:s.total,isHit:!1,isCritMiss:!0,fumbleEvent:x.message,attackerDamage:x.attackerDamage||0}),t.next=64;break;case 49:if(!(S=s.total>=u)){t.next=62;break}if(d+=" It's a hit! ".concat(o.name," deals ").concat(g," damage to ").concat(c.name,"."),!y){t.next=55;break}return t.next=55,y.toMessage({speaker:ChatMessage.getSpeaker({actor:o}),flavor:"".concat(o.name," deals damage!")});case 55:return E=c.system.attributes.hp.value,L=Math.max(0,E-g),t.next=59,c.update({"system.attributes.hp.value":L});case 59:game.socket.emit("module.discord-bot-integration",{action:"attackResult",requestId:n,actorName:o.name,targetName:c.name,attackTotal:s.total,damageTotal:g,isHit:S}),t.next=64;break;case 62:d+=" The attack misses!",game.socket.emit("module.discord-bot-integration",{action:"attackResult",requestId:n,actorName:o.name,targetName:c.name,attackTotal:s.total,isHit:!1});case 64:if(!s){t.next=67;break}return t.next=67,s.toMessage({speaker:ChatMessage.getSpeaker({actor:o}),flavor:d});case 67:return t.abrupt("return",d);case 70:return t.prev=70,t.t0=t.catch(9),console.error("Error during enhanced attack roll:",t.t0),t.abrupt("return","Error during attack roll: ".concat(t.t0.message));case 74:case"end":return t.stop()}var w}),t,null,[[9,70]])})))).apply(this,arguments)}function tt(t){return et.apply(this,arguments)}function et(){return(et=S(w().mark((function t(e){var n,r,a,o,c,i,s,u,l,f,d,p,m,y;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.requestId,r=e.saveType,a=e.actorId,o=e.dc,c=h(e.actorId)){t.next=5;break}return console.warn("Actor with ID ".concat(a," not found")),t.abrupt("return","".concat(oe," | Actor with ID ").concat(a," not found"));case 5:if(!(i=c.getRollData()).abilities[r]){t.next=12;break}s=i.abilities[r].save,u="1d20 + ".concat(s),l=r.toUpperCase(),t.next=20;break;case 12:if(!i.skills[r]){t.next=18;break}s=i.skills[r].total,u="1d20 + ".concat(s),l=i.skills[r].ability.toUpperCase()+" ("+r+")",t.next=20;break;case 18:return console.warn("Unknown save type: ".concat(r)),t.abrupt("return","".concat(oe," | Unknown save type: ").concat(r));case 20:return t.next=22,new Roll(u,i).evaluate({async:!0});case 22:return f=t.sent,d=20===f.total,p=1===f.total,m="".concat(c.name," makes a ").concat(l," saving throw. Result: ").concat(f.total),y=null,void 0!==o&&(y=f.total>=o,m+=y?" - Success! (DC: ".concat(o,")"):" - Failure. (DC: ".concat(o,")")),d?m+=" **Critical Success!**":p&&(m+=" **Critical Failure!**"),game.socket.emit("module.discord-bot-integration",{action:"savingThrowResult",requestId:n,actorName:c.name,saveType:l,result:f.total,isCritSuccess:d,isCritFailure:p,dc:o,success:y}),t.next=32,f.toMessage({speaker:ChatMessage.getSpeaker({actor:c}),flavor:m});case 32:return t.abrupt("return",m);case 33:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function nt(t){return rt.apply(this,arguments)}function rt(){return(rt=S(w().mark((function t(e){var n,r,a,o,c,i,s,u,l,f;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.requestId,r=e.actorId,a=e.amount,o=h(e.actorId)){t.next=5;break}return console.warn("".concat(oe," | Actor with ID ").concat(r," not found")),t.abrupt("return","".concat(oe," | Actor with ID ").concat(r," not found"));case 5:return c=o.system.attributes.hp.value,i=o.system.attributes.hp.max,a<0?(u="damage",s=Math.max(0,c+a)):(u="healing",s=Math.min(i,c+a)),t.next=10,o.update({"system.attributes.hp.value":s});case 10:return l="damage"===u?"Damage":"Healing",console.log("".concat(oe," | ").concat(l," applied: ").concat(Math.abs(a),". New HP: ").concat(s)),game.socket.emit("module.discord-bot-integration",{action:"hpUpdated",requestId:n,actorName:o.name,currentHP:s,maxHP:i,changeType:u,changeAmount:Math.abs(a)}),f="".concat(o.name," ").concat("damage"===u?"takes":"receives"," ").concat(Math.abs(a)," ").concat(u," and now has ").concat(s,"/").concat(i," HP."),t.next=16,ChatMessage.create({speaker:ChatMessage.getSpeaker({actor:o}),content:f});case 16:return t.abrupt("return",f);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function at(t){return ot.apply(this,arguments)}function ot(){return(ot=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.requestId,a=n.tableId,e("".concat(oe," | rollOnTable:"),a),o=game.tables.get(a)){t.next=7;break}return e("".concat(oe," | Table with ID ").concat(a," not found")),console.warn("Table with ID ".concat(a," not found")),t.abrupt("return");case 7:return t.next=9,o.draw();case 9:return c=t.sent,i=c.results.map((function(t){return t.getChatText()})).join(", "),e("".concat(oe," | rollOnTable:"),a,i),game.socket.emit("module.discord-bot-integration",{action:"tableRollResult",requestId:r,tableName:o.name,result:i}),t.abrupt("return",i);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ct(t){return it.apply(this,arguments)}function it(){return(it=S(w().mark((function t(n){var r,a,o,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.requestId,a=n.encounterType,c=(o={forest:["Wolf","Goblin Scout","Bandit"],dungeon:["Skeleton","Zombie","Giant Spider"],town:["Thief","Guard Patrol","Pickpocket"]}[a]||[]).length>0?o[Math.floor(Math.random()*o.length)]:"Nothing found",e("".concat(oe," | generateRandomEncounter:"),a,c),game.socket.emit("module.discord-bot-integration",{action:"randomEncounterResult",requestId:r,encounterType:a,encounter:c}),t.abrupt("return",c);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function st(t,e){return ut.apply(this,arguments)}function ut(){return(ut=S(w().mark((function t(n,r){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e("".concat(oe," | Relaying message to Discord2: ").concat(n)),game.socket.emit("module.discord-bot-integration",{action:"chatRelayToDiscord",requestId:r,message:n});case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function lt(t){return ft.apply(this,arguments)}function ft(){return(ft=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.requestId,a=n.characterId,o=n.message,c=h(a)){t.next=6;break}return e("".concat(oe," | Character with ID ").concat(a," not found")),console.warn("Character with ID ".concat(a," not found")),t.abrupt("return");case 6:i="<strong>".concat(c.name,"</strong>: ").concat(o),ChatMessage.create({content:i,speaker:{actor:c}}),e("".concat(oe," | Relaying message to Discord3: ").concat(o)),game.socket.emit("module.discord-bot-integration",{action:"rpCommandRelay",requestId:r,characterName:c.name,message:o});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function dt(t){return pt.apply(this,arguments)}function pt(){return(pt=S(w().mark((function t(n){var r,a,o,c,i,s,u,l;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.requestId,a=n.casterId,o=n.spellId,c=n.targetId,i=h(a),e("".concat(oe," | castSpell:"),a,o,c),i){t.next=7;break}return e("".concat(oe," | Caster with ID ").concat(a," not found")),console.warn("Caster with ID ".concat(a," not found")),t.abrupt("return");case 7:if((s=i.items.get(o))&&"spell"===s.type){t.next=12;break}return e("".concat(oe," | Spell with ID ").concat(o," not found or is not a spell")),console.warn("Spell with ID ".concat(o," not found or is not a spell")),t.abrupt("return");case 12:return u=h(c),l=s.system.description.value||"No description available",ChatMessage.create({content:"<strong>".concat(i.name,"</strong> casts <strong>").concat(s.name,"</strong> on <strong>").concat(u?u.name:"Unknown Target","</strong><br>").concat(l),speaker:{actor:i}}),game.socket.emit("module.discord-bot-integration",{action:"spellCastNotification",requestId:r,casterName:i.name,spellName:s.name,targetName:u?u.name:"Unknown Target",description:l}),t.next=18,mt(s,i,u);case 18:return t.abrupt("return","".concat(i.name," casts ").concat(s.name," on ").concat(u?u.name:"Unknown Target"));case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mt(t,e,n){return ht.apply(this,arguments)}function ht(){return(ht=S(w().mark((function t(n,r,a){var o,c,i,s,u,l,f,d,p,m,h;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:if(c=(null===(o=n.system.damage)||void 0===o?void 0:o.parts)||[],i=c.find((function(t){return"healing"===t[1]})),s=c.find((function(t){return"damage"===t[1]})),!i){t.next=11;break}return u=yt(i,r),t.next=9,a.update({"system.attributes.hp.value":Math.min(a.system.attributes.hp.max,a.system.attributes.hp.value+u)});case 9:e("".concat(oe," | Healing applied: ").concat(u,". New HP: ").concat(a.system.attributes.hp.value)),game.socket.emit("module.discord-bot-integration",{action:"spellEffectApplied",casterName:r.name,effect:"heals ".concat(a.name," for ").concat(u," HP")});case 11:if(!s){t.next=28;break}if(f=yt(s,r),null===(l=n.system.save)||void 0===l||!l.dc){t.next=19;break}return t.next=16,tt(a,n.system.save.dc);case 16:t.t0=t.sent,t.next=20;break;case 19:t.t0=null;case 20:return d=t.t0,p=d&&d.total>=n.system.save.dc,m=p?Math.floor(f/2):f,t.next=25,a.update({"system.attributes.hp.value":Math.max(0,a.system.attributes.hp.value-m)});case 25:e("".concat(oe," | Damage applied: ").concat(m,". New HP: ").concat(a.system.attributes.hp.value)),game.socket.emit("module.discord-bot-integration",{action:"spellEffectApplied",casterName:r.name,effect:"deals ".concat(m," damage to ").concat(a.name).concat(p?" (half due to successful save)":"")}),ChatMessage.create({content:"".concat(a.name," ").concat(p?"saves partially":"fails to save"," against ").concat(n.name," and takes ").concat(m," damage.")});case 28:n.system.duration&&"condition"===n.system.duration.units&&(h=n.system.duration.value,a.createEmbeddedDocuments("ActiveEffect",[{label:h,icon:n.img,origin:r.uuid,changes:[{key:"flags.conditions",mode:0,value:h}]}]),e("".concat(oe," | Condition applied: ").concat(h)),game.socket.emit("module.discord-bot-integration",{action:"conditionApplied",targetName:a.name,condition:h}),ChatMessage.create({content:"".concat(a.name," is now affected by ").concat(h," from ").concat(n.name,".")}));case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yt(t,n){var r=x(t,2),a=r[0],o=r[1],c=new Roll(a,n.getRollData()).evaluate({async:!1});return e("".concat(oe," | Spell effect formula: ").concat(a,", type: ").concat(o,", roll: ").concat(c.total)),c.total}function gt(t){return vt.apply(this,arguments)}function vt(){return(vt=S(w().mark((function t(n){var r,a,o,c,i,s,u,l,f,d,p;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.casterId,o=n.abilityId,c=n.targetId,i=n.requestId,e("".concat(oe," | useAbility:"),n),s=h(a)){t.next=7;break}return e("".concat(oe," | Caster with ID ").concat(a," not found")),console.warn("Caster with ID ".concat(a," not found")),t.abrupt("return");case 7:if((u=s.items.get(o))&&"feat"===u.type){t.next=12;break}return e("".concat(oe," | Ability with ID ").concat(o," not found or is not an ability")),console.warn("Ability with ID ".concat(o," not found or is not an ability")),t.abrupt("return");case 12:if(l=h(c)||s,f=u.system.description.value||"No description available",!((d=(null===(r=u.system.uses)||void 0===r?void 0:r.value)>0)&&u.system.uses.value<=0)){t.next=19;break}return p="".concat(s.name," cannot use ").concat(u.name,", no charges left!"),ChatMessage.create({content:p}),t.abrupt("return",p);case 19:return ChatMessage.create({content:"<strong>".concat(s.name,"</strong> uses <strong>").concat(u.name,"</strong> on <strong>").concat(l?l.name:"Unknown Target","</strong><br>").concat(f),speaker:{actor:s}}),t.next=22,bt(u,s,l);case 22:if(!d){t.next=25;break}return t.next=25,u.update({"system.uses.value":u.system.uses.value-1});case 25:return game.socket.emit("module.discord-bot-integration",{action:"abilityUseNotification",requestId:i,casterName:s.name,abilityName:u.name,targetName:l?l.name:"Unknown Target",description:f}),e("".concat(oe," | Ability used: ").concat(u.name," on ").concat(l?l.name:"Unknown Target")),t.abrupt("return","Ability used: ".concat(u.name," on ").concat(l?l.name:"Unknown Target"));case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bt(t,e,n){return wt.apply(this,arguments)}function wt(){return(wt=S(w().mark((function t(n,r,a){var o,c,i,s,u,l,f,d;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | applyAbilityEffects:"),n,r,a),!(s=null===(o=n.system.damage)||void 0===o?void 0:o.parts.find((function(t){return"healing"===t[1]})))){t.next=8;break}return u=xt(s,r),t.next=6,a.update({"system.attributes.hp.value":Math.min(a.system.attributes.hp.max,a.system.attributes.hp.value+u)});case 6:e("".concat(oe," | Healing applied: ").concat(u," HP to ").concat(a.name)),ChatMessage.create({content:"".concat(a.name," is healed for ").concat(u," HP by ").concat(r.name,"'s ").concat(n.name,".")});case 8:if(!(l=null===(c=n.system.damage)||void 0===c?void 0:c.parts.find((function(t){return"damage"===t[1]})))){t.next=15;break}return f=xt(l,r),t.next=13,a.update({"system.attributes.hp.value":Math.max(0,a.system.attributes.hp.value-f)});case 13:e("".concat(oe," | Damage applied: ").concat(f," damage to ").concat(a.name)),ChatMessage.create({content:"".concat(a.name," takes ").concat(f," damage from ").concat(r.name,"'s ").concat(n.name,".")});case 15:if("condition"!==(null===(i=n.system.duration)||void 0===i?void 0:i.units)){t.next=22;break}return d=n.system.duration.value,t.next=20,a.createEmbeddedDocuments("ActiveEffect",[{label:d,icon:n.img,origin:r.uuid,changes:[{key:"flags.conditions",mode:0,value:d}]}]);case 20:e("".concat(oe," | Condition applied: ").concat(d," to ").concat(a.name)),ChatMessage.create({content:"".concat(a.name," is affected by ").concat(d," from ").concat(r.name,"'s ").concat(n.name,".")});case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xt(t,n){var r=x(t,2),a=r[0],o=r[1],c=new Roll(a,n.getRollData()).evaluate({async:!1});return e("".concat(oe," | Effect formula: ").concat(a,", type: ").concat(o,", roll: ").concat(c.total)),c.total}function kt(t){return It.apply(this,arguments)}function It(){return(It=S(w().mark((function t(n){var r,a,o,c,i,s;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | viewQuestLog:"),n),r=n.id,(a=game.journal.contents.filter((function(t){return!0===t.flags.questLog}))).length){t.next=7;break}return e("".concat(oe," | viewQuestLog: No quests found.")),game.socket.emit("module.discord-bot-integration",{action:"questLogResponse",requestId:r,questLog:"No quests available in the quest log."}),t.abrupt("return","No quests available in the quest log.");case 7:return o=a.map((function(t){return{title:t.name,content:t.data.content,status:t.flags.status||"In Progress",objectives:t.flags.objectives||[],rewards:t.flags.rewards||"Unknown",difficulty:t.flags.difficulty||"Normal",questGiver:t.flags.questGiver||"Unknown"}})),c={InProgress:o.filter((function(t){return"In Progress"===t.status})),Completed:o.filter((function(t){return"Completed"===t.status})),Failed:o.filter((function(t){return"Failed"===t.status}))},i=function(t){var e=t.objectives.length?t.objectives.map((function(t,e){return"  ".concat(e+1,". ").concat(t.description," (").concat(t.completed?"":"",")")})).join("\n"):"No objectives listed.";return"**".concat(t.title,"**\nStatus: ").concat(t.status,"\nDifficulty: ").concat(t.difficulty,"\nQuest Giver: ").concat(t.questGiver,"\nRewards: ").concat(t.rewards,"\nObjectives:\n").concat(e,"\n\n").concat(t.content)},s=["### **Quest Log** ###\n","--- In Progress ---\n".concat(c.InProgress.map(i).join("\n\n---\n")),"--- Completed ---\n".concat(c.Completed.map(i).join("\n\n---\n")),"--- Failed ---\n".concat(c.Failed.map(i).join("\n\n---\n"))].join("\n\n"),e("".concat(oe," | viewQuestLogQuestSummary:"),s),game.socket.emit("module.discord-bot-integration",{action:"questLogResponse",requestId:r,questLog:s}),t.abrupt("return",o);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function St(t){return Et.apply(this,arguments)}function Et(){return(Et=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | updateQuestStatus:"),n),r=n.requestId,a=n.questId,o=n.newStatus,(c=game.journal.get(a))&&c.flags.questLog){t.next=6;break}return console.warn("Quest with ID ".concat(a," not found or is not a quest log entry")),t.abrupt("return","Quest with ID ".concat(a," not found or is not part of the quest log."));case 6:return i=v(v({},c.flags),{},{status:o}),t.next=9,c.update({flags:i});case 9:return e("".concat(oe," | Quest status updated:"),c.name,o),game.socket.emit("module.discord-bot-integration",{action:"questStatusUpdated",requestId:r,questName:c.name,newStatus:o}),t.abrupt("return",'Quest "'.concat(c.name,'" status updated to "').concat(o,'".'));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lt(t){return Nt.apply(this,arguments)}function Nt(){return(Nt=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.requestId,a=n.questId,o=n.objectiveIndex,(c=game.journal.get(a))&&c.flags.questLog){t.next=5;break}return console.warn("Quest with ID ".concat(a," not found or is not a quest log entry")),t.abrupt("return","Quest with ID ".concat(a," not found or is not part of the quest log."));case 5:if(i=c.flags.objectives||[],!(o>=i.length||o<0)){t.next=9;break}return console.warn("Objective index ".concat(o," is out of bounds")),t.abrupt("return","Objective index ".concat(o,' is out of bounds for quest "').concat(c.name,'".'));case 9:return i[o].completed=!0,t.next=12,c.update({"flags.objectives":i});case 12:return e("".concat(oe," | Quest objective updated:"),c.name,i[o].description),game.socket.emit("module.discord-bot-integration",{action:"questObjectiveUpdated",requestId:r,questName:c.name,objective:i[o].description}),t.abrupt("return",'Objective "'.concat(i[o].description,'" marked as completed in quest "').concat(c.name,'".'));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function qt(t){return Dt.apply(this,arguments)}function Dt(){return(Dt=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | addNoteToLog:"),n),r=n.questId,a=n.note,o=n.requestId,c=game.journal.get(r)){t.next=7;break}return e("".concat(oe," | Quest with ID ").concat(r," not found")),console.warn("Quest with ID ".concat(r," not found")),t.abrupt("return","Quest with ID ".concat(r," not found."));case 7:return i=c.data.content+"\n\n**Note:** ".concat(a),t.next=10,c.update({content:i});case 10:return e("".concat(oe," | addNoteToLog:"),c,i),game.socket.emit("module.discord-bot-integration",{action:"noteAddedConfirmation",requestId:o,questTitle:c.name,note:a}),t.abrupt("return",'Note "'.concat(a,'" added to quest "').concat(c.name,'".'));case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function jt(t){return Ot.apply(this,arguments)}function Ot(){return(Ot=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e("".concat(oe," | queryNpcStats:"),n),r=n.npcId,a=n.requestId,o=h(r)){t.next=7;break}return e("".concat(oe," | NPC with ID ").concat(r," not found")),console.warn("NPC with ID ".concat(r," not found")),t.abrupt("return");case 7:return c={name:o.name,hp:o.system.attributes.hp.value,ac:o.system.attributes.ac.value,abilities:{str:o.system.abilities.str.value,dex:o.system.abilities.dex.value,con:o.system.abilities.con.value,int:o.system.abilities.int.value,wis:o.system.abilities.wis.value,cha:o.system.abilities.cha.value}},e("".concat(oe," | queryNpcStats:"),c),i="\n  **".concat(c.name,"**\n\n  HP: ").concat(c.hp,", AC: ").concat(c.ac,"\n\n  STR: ").concat(c.abilities.str,", DEX: ").concat(c.abilities.dex,", CON: ").concat(c.abilities.con,"\n\n  INT: ").concat(c.abilities.int,", WIS: ").concat(c.abilities.wis,", CHA: ").concat(c.abilities.cha,"\n  "),game.socket.emit("module.discord-bot-integration",{action:"npcStatsResponse",requestId:a,npcSummary:i}),t.abrupt("return",c);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ct(t){return Tt.apply(this,arguments)}function Tt(){return(Tt=S(w().mark((function t(n){var r,a,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pt();case 2:return r=t.sent,e("".concat(oe," | generateRandomNpc:"),r),a=n.id,o="\n  **Name**: ".concat(r.name,"\n\n  HP: ").concat(r.hp,", AC: ").concat(r.ac,"\n\n  Abilities: STR ").concat(r.str,", DEX ").concat(r.dex,", CON ").concat(r.con,", INT ").concat(r.int,", WIS ").concat(r.wis,", CHA ").concat(r.cha,"\n  "),e("".concat(oe," | generateRandomNpcSummary:"),o),game.socket.emit("module.discord-bot-integration",{action:"randomNpcResponse",requestId:a,randomNpcSummary:o}),t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Pt(){return At.apply(this,arguments)}function At(){return(At=S(w().mark((function t(){var n,r,a,o,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(n=["Orc Warrior","Goblin Shaman","Bandit Leader","Dire Wolf"])[Math.floor(Math.random()*n.length)],a=Math.floor(30*Math.random())+20,o=Math.floor(6*Math.random())+10,c={str:Math.floor(8*Math.random())+10,dex:Math.floor(8*Math.random())+10,con:Math.floor(8*Math.random())+10,int:Math.floor(8*Math.random())+8,wis:Math.floor(8*Math.random())+8,cha:Math.floor(8*Math.random())+8},e("".concat(oe," | createRandomNpc:"),r,a,o,c),t.abrupt("return",v({name:r,hp:a,ac:o},c));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Mt(t){return Rt.apply(this,arguments)}function Rt(){return(Rt=S(w().mark((function t(n){var r,a,o,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.characterId,a=n.requestId,o=h(r)){t.next=6;break}return e("".concat(oe," | Character with ID ").concat(r," not found")),console.warn("Character with ID ".concat(r," not found")),t.abrupt("return");case 6:return t.next=8,o.longRest({dialog:!1,chat:!1});case 8:return c="\n  **".concat(o.name," has completed a Long Rest**\n\n  HP fully restored to ").concat(o.system.attributes.hp.value,"/").concat(o.system.attributes.hp.max,"\n\n  All spell slots and abilities are refreshed.\n  "),e("".concat(oe," | handleLongRest:"),c),game.socket.emit("module.discord-bot-integration",{action:"restNotification",requestId:a,restSummary:c}),t.abrupt("return",c);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _t(t){return Gt.apply(this,arguments)}function Gt(){return(Gt=S(w().mark((function t(n){var r,a,o,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.characterId,a=n.requestId,e("".concat(oe," | handleShortRest:"),r,a),o=h(r)){t.next=7;break}return e("".concat(oe," | Character with ID ").concat(r," not found")),console.warn("Character with ID ".concat(r," not found")),t.abrupt("return");case 7:return t.next=9,o.shortRest({dialog:!1,chat:!1});case 9:return c="\n  **".concat(o.name," has completed a Short Rest**\n\n  HP partially restored based on hit dice. Check abilities and spells for partial recovery.\n  "),e("".concat(oe," | handleShortRest:"),c),game.socket.emit("module.discord-bot-integration",{action:"restNotification",requestId:a,restSummary:c}),t.abrupt("return",c);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ht(t){return Ut.apply(this,arguments)}function Ut(){return(Ut=S(w().mark((function t(n){var r,a,o,c,i,s;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.sessionData,a=n.requestId,o=r.sessionTitle,c=r.participants,i=(new Date).toLocaleString(),e("".concat(oe," | handleSessionStart:"),o,i,c),s="\n  **Session Started: ".concat(o,"**\n  Start Time: ").concat(i,"\n  Participants: ").concat(c.join(", "),"\n  Good luck and enjoy the adventure!\n    "),e("".concat(oe," | startMessage:"),s),game.socket.emit("module.discord-bot-integration",{action:"sessionNotification",requestId:a,message:s,type:"startSession"}),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ft(t){return Qt.apply(this,arguments)}function Qt(){return(Qt=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e("".concat(oe," | handleSessionEnd:"),n),r=n.sessionData,a=n.requestId,o=r.sessionTitle,c=(new Date).toLocaleString(),e("".concat(oe," | handleSessionEnd:"),o,c),i="\n  **Session Ended: ".concat(o,"**\n  End Time: ").concat(c,"\n  Thank you for playing. See you next time!\n    "),e("".concat(oe," | endMessage:"),i),game.socket.emit("module.discord-bot-integration",{action:"sessionNotification",requestId:a,message:i,type:"endSession"}),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Yt(t){return Bt.apply(this,arguments)}function Bt(){return(Bt=S(w().mark((function t(n){var r,a,o,c,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.logData,a=n.requestId,o=r.sessionTitle,c=r.notes,e("".concat(oe," | handleLogSessionNotes:"),o,c),i="\n  **Session Notes for ".concat(o,":**\n  ").concat(c,"\n    "),e("".concat(oe," | notesMessage:"),i),game.socket.emit("module.discord-bot-integration",{action:"sessionNotification",requestId:a,message:i,type:"sessionLog"}),t.abrupt("return",i);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.d({},{p:()=>oe}),e("[Discord Bot Integration] Hooks module loading..."),e("".concat(oe," setting up api..."));var Wt=["action","requestId"];function Jt(t){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(t)}function Xt(){Xt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,c=Object.create(o.prototype),i=new j(r||[]);return a(c,"_invoke",{value:L(t,n,i)}),c}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",p="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(O([])));k&&k!==n&&r.call(k,c)&&(w=k);var I=b.prototype=g.prototype=Object.create(w);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(a,o,c,i){var s=f(t[a],t,o);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Jt(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,c,i)}),(function(t){n("throw",t,c,i)})):e.resolve(l).then((function(t){u.value=t,c(u)}),(function(t){return n("throw",t,c,i)}))}i(s.arg)}var o;a(this,"_invoke",{value:function(t,r){function a(){return new e((function(e,a){n(t,r,e,a)}))}return o=o?o.then(a,a):a()}})}function L(e,n,r){var a=d;return function(o,c){if(a===m)throw Error("Generator is already running");if(a===h){if("throw"===o)throw c;return{value:t,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var s=N(i,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===d)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=m;var u=f(e,n,r);if("normal"===u.type){if(a=r.done?h:p,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=h,r.method="throw",r.arg=u.arg)}}}function N(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var c=o.arg;return c?c.done?(n[e.resultName]=c.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function q(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(q,this),this.reset(!0)}function O(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Jt(e)+" is not iterable")}return v.prototype=b,a(I,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},S(E.prototype),u(E.prototype,i,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var c=new E(l(t,n,r,a),o);return e.isGeneratorFunction(n)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},S(I),u(I,s,"Generator"),u(I,c,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=O,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return i.type="throw",i.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],i=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var s=r.call(c,"catchLoc"),u=r.call(c,"finallyLoc");if(s&&u){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=t,c.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),D(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function $t(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function zt(t,e,n,r,a,o,c){try{var i=t[o](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function Vt(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function c(t){zt(o,r,a,c,i,"next",t)}function i(t){zt(o,r,a,c,i,"throw",t)}c(void 0)}))}}function Zt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Kt(r.key),r)}}function Kt(t){var e=function(t){if("object"!=Jt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jt(e)?e:e+""}var te=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.functions=new Map,this.requests=new Map,this.name="module.".concat(oe),console.log("".concat(oe," this.name:"),this.name),game.socket.on(this.name,this._received.bind(this)),this.register("updateCharacterHP",T),this.register("rollInitiative",W),this.register("castSpell",dt),this.register("getCharacterStats",E),this.register("getCharacterInventory",N),this.register("getCharacterSpells",D),this.register("rollAttack",Z),this.register("applyDamageOrHealing",nt),this.register("rollSavingThrow",tt),this.register("handleLongRest",Mt),this.register("handleShortRest",_t),this.register("sendCharacterSpells",O),this.register("updateCharacterCondition",A),this.register("updateResource",_),this.register("addItemToInventory",H),this.register("removeItemFromInventory",F),this.register("getItemDetails",Y),this.register("sendTurnNotification",X),this.register("sendCombatSummary",z),this.register("rollOnTable",at),this.register("generateRandomEncounter",ct),this.register("relayChatToDiscord",st),this.register("relayRPCommand",lt),this.register("useAbility",gt),this.register("viewQuestLog",kt),this.register("addNoteToLog",qt),this.register("queryNpcStats",jt),this.register("generateRandomNpc",Ct),this.register("handleSessionStart",Ht),this.register("handleSessionEnd",Ft),this.register("handleLogSessionNotes",Yt),this.register("updateQuestStatus",St),this.register("updateQuestObjective",Lt)},n=[{key:"register",value:function(t,n){this.functions.has(t)?e("".concat(oe," | Function '").concat(t,"' is already registered, skipping duplicate.")):(e("".concat(oe," | Registering function '").concat(t,"'...")),this.functions.set(t,n))}},{key:"_receiveRequest",value:(a=Vt(Xt().mark((function t(n,r){var a,o,c,i,s;return Xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.action,o=n.requestId,c=$t(n,Wt),i=this.functions.get(a)){t.next=5;break}return e("".concat(oe," | No function registered for action '").concat(a,"'")),t.abrupt("return");case 5:return t.prev=5,t.next=8,i(c);case 8:s=t.sent,e("Success executing '".concat(a,"':"),s),game.socket.emit(this.name,{action:"".concat(a,"Result"),requestId:o,type:"RESPONSE",result:s}),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(5),e("".concat(oe," | Error executing '").concat(a,"':"),t.t0),game.socket.emit(this.name,{action:"".concat(a,"Result"),requestId:o,type:"RESPONSE",error:t.t0.message});case 17:case"end":return t.stop()}}),t,this,[[5,13]])}))),function(t,e){return a.apply(this,arguments)})},{key:"_receiveResponse",value:function(t,n){var r=t.id,a=t.result,o=t.type,c=this.requests.get(r);c&&("RESULT"===o?(e("".concat(oe," | Success executing '").concat(c.functionName,"':"),a),c.resolve(a)):(e("".concat(oe," | Error executing '").concat(c.functionName,"':"),a),c.reject(new Error("Error executing '".concat(c.functionName,"'. Check GM console for details.")))),this.requests.delete(r))}},{key:"_received",value:function(t,n){"REQUEST"===t.type?(e("".concat(oe," | Received request:"),t),this._receiveRequest(t,n)):(e("".concat(oe," | Received response:"),t),this._receiveResponse(t,n))}},{key:"_sendRequest",value:function(t,n,r){var a=this,o={functionName:t,args:n,recipient:r,type:"REQUEST",id:foundry.utils.randomID()},c=new Promise((function(e,n){return a.requests.set(o.id,{functionName:t,resolve:e,reject:n})}));return e("".concat(oe," | Sending request:"),o),game.socket.emit(this.name,o),c}},{key:"executeAsGM",value:(r=Vt(Xt().mark((function t(n){var r,a,o,c,i=arguments;return Xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=this.functions.get(n),a=i.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=i[c];if(!game.user.isGM){t.next=4;break}return t.abrupt("return",r.apply(void 0,o));case 4:return e("".concat(oe," | Executing '").concat(n,"' as GM:"),o),t.abrupt("return",this._sendRequest(n,o,"GM"));case 6:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})}],n&&Zt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,a}();function ee(t){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ee(t)}function ne(){ne=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,c=Object.create(o.prototype),i=new j(r||[]);return a(c,"_invoke",{value:L(t,n,i)}),c}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",p="suspendedYield",m="executing",h="completed",y={};function g(){}function v(){}function b(){}var w={};u(w,c,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(O([])));k&&k!==n&&r.call(k,c)&&(w=k);var I=b.prototype=g.prototype=Object.create(w);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(a,o,c,i){var s=f(t[a],t,o);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ee(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,c,i)}),(function(t){n("throw",t,c,i)})):e.resolve(l).then((function(t){u.value=t,c(u)}),(function(t){return n("throw",t,c,i)}))}i(s.arg)}var o;a(this,"_invoke",{value:function(t,r){function a(){return new e((function(e,a){n(t,r,e,a)}))}return o=o?o.then(a,a):a()}})}function L(e,n,r){var a=d;return function(o,c){if(a===m)throw Error("Generator is already running");if(a===h){if("throw"===o)throw c;return{value:t,done:!0}}for(r.method=o,r.arg=c;;){var i=r.delegate;if(i){var s=N(i,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===d)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=m;var u=f(e,n,r);if("normal"===u.type){if(a=r.done?h:p,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=h,r.method="throw",r.arg=u.arg)}}}function N(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var c=o.arg;return c?c.done?(n[e.resultName]=c.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function q(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function D(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(q,this),this.reset(!0)}function O(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(ee(e)+" is not iterable")}return v.prototype=b,a(I,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(I),t},e.awrap=function(t){return{__await:t}},S(E.prototype),u(E.prototype,i,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var c=new E(l(t,n,r,a),o);return e.isGeneratorFunction(n)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},S(I),u(I,s,"Generator"),u(I,c,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=O,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return i.type="throw",i.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],i=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var s=r.call(c,"catchLoc"),u=r.call(c,"finallyLoc");if(s&&u){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=t,c.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(c)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),D(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function re(t,e,n,r,a,o,c){try{var i=t[o](c),s=i.value}catch(t){return void n(t)}i.done?e(s):Promise.resolve(s).then(r,a)}function ae(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function c(t){re(o,r,a,c,i,"next",t)}function i(t){re(o,r,a,c,i,"throw",t)}c(void 0)}))}}var oe="discord-bot-integration";console.log("".concat(oe," module loading...")),Hooks.once("init",ae(ne().mark((function t(){return ne().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("".concat(oe," | Initializing module")),game.settings.register("discord-bot-integration","useEnv",{name:"Use .env for Development",hint:"Enable to load environment variables from a .env file during development.",scope:"world",config:!0,type:Boolean,default:!1}),game.settings.register("discord-bot-integration","discordApiToken",{name:"Discord API Token",hint:"Enter the Discord API token for the bot (required for production).",scope:"world",config:!0,type:String,default:""}),game.settings.register("discord-bot-integration","middlewareUrl",{name:"Middleware URL",hint:"The URL for your FastAPI middleware that connects to Discord.",scope:"world",config:!0,type:String,default:"http://localhost:8000"}),game.settings.register("discord-bot-integration","debugMode",{name:"Enable Debug Mode",hint:"Enable verbose logging for debugging purposes.",scope:"world",config:!0,type:Boolean,default:!1}),game.settings.register("discord-bot-integration","notificationChannel",{name:"Discord Notification Channel ID",hint:"ID of the Discord channel where notifications will be sent.",scope:"world",config:!0,type:String,default:""});case 2:case"end":return t.stop()}}),t)})))),Hooks.once("ready",(function(){console.log("".concat(oe," | Foundry ready, setting up hooks and socket")),Hooks.on("updateActor",(function(t,n,r,a){e("".concat(oe," | Actor updated: ").concat(t.name)),game.socket.emit("module.".concat(oe),{action:"actorUpdated",actorId:t.id,actorData:t.toJSON()})})),Hooks.on("createItem",(function(t,n,r){e("".concat(oe," | Item created: ").concat(t.name));var a=t.parent;a&&(e("".concat(oe," | Item added to ").concat(a.name,"'s inventory: ").concat(t.name)),game.socket.emit("module.".concat(oe),{action:"itemAdded",actorId:a.id,itemData:t.toJSON()}))})),Hooks.on("deleteItem",(function(t,n,r){e("".concat(oe," | Item deleted: ").concat(t.name));var a=t.parent;a&&(e("".concat(oe," | Item removed from ").concat(a.name,"'s inventory: ").concat(t.name)),game.socket.emit("module.".concat(oe),{action:"itemRemoved",actorId:a.id,itemId:t.id}))})),Hooks.on("updateCombat",(function(t,n,r,a){var o=t.combatants.map((function(t){var e,n;return{id:t.id,name:t.name,initiative:t.initiative,hp:null===(e=t.actor)||void 0===e?void 0:e.system.attributes.hp.value,statusEffects:null===(n=t.actor)||void 0===n?void 0:n.effects.map((function(t){return t.label}))}}));e("".concat(oe," | Combat updated: Combat ID ").concat(t.id));var c=t.combatant.actor.name;game.socket.emit("module.".concat(oe),{action:"combatUpdated",combatId:t.id,round:t.round,turn:t.turn,combatants:o,currentCombatant:c})})),Hooks.on("combatTurn",(function(t){var n=t.combatant;n&&(e("".concat(oe," | Turn notification for: ").concat(n.actor.name)),game.socket.emit("module.".concat(oe),{action:"turnNotification",combatantName:n.actor.name,combatantId:n.actor.id,initiative:n.initiative,round:t.round,turn:t.turn}))})),Hooks.on("createChatMessage",(function(t,n,r){var a=t.system.content;e("".concat(oe," | Relaying message to Discord1: ").concat(a)),game.socket.emit("module.".concat(oe),{action:"chatRelayToDiscord",message:a})})),Hooks.on("useItem",(function(t,n){e("".concat(oe," | Item used: ").concat(t.name));var r=t.actor;!r||"spell"!==t.type&&"feat"!==t.type||(e("".concat(oe," | Spell or ability used: ").concat(t.name)),game.socket.emit("module.".concat(oe),{action:"spell"===t.type?"spellUsed":"abilityUsed",casterName:r.name,itemName:t.name,description:t.data.data.description.value}))})),Hooks.on("restComplete",(function(t,n){e("".concat(oe," | Rest completed: ").concat(t.name));var r=n.longRest?"longRest":"shortRest";e("".concat(oe," | ").concat(t.name," completed a ").concat(r)),game.socket.emit("module.".concat(oe),{action:r,actorId:t.id,actorName:t.name})})),e("".concat(oe," hooks registered")),globalThis.SocketHandler=new te,e("".concat(oe," | Socket setup complete"))}))})();
//# sourceMappingURL=main.js.map